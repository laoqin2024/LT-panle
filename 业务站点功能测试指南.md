# 业务站点功能测试指南

本文档说明如何测试业务站点管理模块的各项功能。

## 一、功能清单

### 1. 基础功能
- ✅ 站点列表展示
- ✅ 站点添加/编辑
- ✅ 站点删除
- ✅ 站点详情查看
- ✅ 分组管理

### 2. 监控功能
- ✅ 站点状态监控
- ✅ 响应时间监控
- ✅ SSL证书过期监控
- ✅ 立即检查功能

### 3. 批量操作
- ✅ 批量选择站点
- ✅ 批量删除站点
- ✅ 批量启用/禁用监控

## 二、测试步骤

### 步骤1：添加测试站点

1. **访问业务站点管理页面**
   - 登录系统后，导航到"业务站点管理"

2. **添加不同类型的站点进行测试**

   **测试用例1：HTTP站点**
   ```
   名称：测试HTTP站点
   URL：http://httpbin.org/get
   类型：测试站点
   描述：用于测试HTTP站点监控
   ```

   **测试用例2：HTTPS站点（域名）**
   ```
   名称：测试HTTPS站点
   URL：https://www.baidu.com
   类型：测试站点
   描述：用于测试HTTPS站点监控和SSL证书检查
   ```

   **测试用例3：HTTPS站点（IP地址）**
   ```
   名称：MES站点
   URL：https://192.168.8.95:7443
   类型：MES站点
   描述：内网IP地址访问的HTTPS站点
   ```
   > **注意**：IP地址访问的HTTPS站点可能会出现SSL证书验证失败，这是正常现象，系统会自动处理。

   **测试用例4：不可达站点**
   ```
   名称：测试离线站点
   URL：https://nonexistent-site-12345.com
   类型：测试站点
   描述：用于测试离线站点检测
   ```

3. **验证添加功能**
   - 点击"添加站点"按钮
   - 填写表单并提交
   - 确认站点出现在列表中
   - 检查站点状态是否为"未知"

### 步骤2：测试立即检查功能

1. **在站点列表中测试**
   - 找到刚添加的站点
   - 点击站点卡片上的"刷新"图标按钮（🔄）
   - 观察按钮是否显示加载动画
   - 等待检查完成

2. **在站点详情页测试**
   - 点击"查看详情"进入站点详情页
   - 点击页面头部的"立即检查"按钮
   - 观察页面数据是否更新

3. **验证检查结果**
   - **HTTP站点**：应该显示"在线"状态，有响应时间
   - **HTTPS站点（域名）**：应该显示"在线"状态，有响应时间和SSL证书过期时间
   - **HTTPS站点（IP地址）**：应该显示"在线"状态，但可能显示SSL证书验证警告
   - **不可达站点**：应该显示"离线"状态

### 步骤3：测试站点详情页功能

1. **查看状态监控标签页**
   - 进入站点详情页
   - 查看"状态监控"标签页
   - 验证以下信息：
     - 响应时间指标
     - 站点状态
     - 可用性统计（如果有历史数据）
     - SSL证书信息

2. **查看历史数据标签页**
   - 切换到"历史数据"标签页
   - 查看响应时间趋势图
   - 查看可用性趋势图

3. **查看告警标签页**
   - 切换到"告警"标签页
   - 目前显示"暂无告警记录"（告警功能待完善）

### 步骤4：测试批量操作功能

1. **批量选择站点**
   - 在站点列表页面
   - 点击站点卡片左侧的复选框，选择多个站点
   - 或点击顶部的"全选"按钮选择所有站点
   - 验证顶部是否显示"已选择 X 个站点"

2. **批量启用监控**
   - 选择多个站点
   - 点击"启用监控"按钮
   - 验证选中的站点是否都启用了监控

3. **批量禁用监控**
   - 选择多个站点
   - 点击"禁用监控"按钮
   - 验证选中的站点是否都禁用了监控

4. **批量删除站点**
   - 选择多个测试站点
   - 点击"批量删除"按钮
   - 确认删除操作
   - 验证选中的站点是否从列表中消失

### 步骤5：测试分组管理功能

1. **创建分组**
   - 在站点列表页面，观察分组筛选区域
   - 目前分组管理功能在前端待完善
   - 可以通过API直接创建分组进行测试

2. **按分组筛选**
   - 点击不同的分组按钮
   - 验证站点列表是否按分组正确筛选

3. **在添加/编辑站点时选择分组**
   - 添加或编辑站点时
   - 在"所属分组"下拉框中选择分组
   - 验证站点是否正确关联到分组

### 步骤6：测试搜索和筛选功能

1. **按状态筛选**
   - 使用状态下拉框筛选
   - 选择"在线"、"离线"、"异常"或"未知"
   - 验证列表是否正确筛选

2. **搜索功能**
   - 在搜索框输入站点名称或URL
   - 验证搜索结果是否正确

3. **组合筛选**
   - 同时使用分组筛选、状态筛选和搜索
   - 验证组合筛选是否正确工作

## 三、常见问题处理

### 问题1：SSL证书验证失败

**现象**：
- 检查IP地址访问的HTTPS站点时，出现"SSL证书验证失败"错误

**原因**：
- 使用IP地址访问HTTPS站点时，SSL证书通常是为域名签发的，不是为IP地址签发的
- 自签名证书也会导致验证失败

**解决方案**：
- 系统已自动处理此情况
- 对于IP地址访问，系统会跳过SSL证书验证
- 站点状态和响应时间仍会正常检查
- SSL证书过期时间可能无法获取，但不会影响站点可用性检查

**验证方法**：
- 检查站点状态是否更新为"在线"
- 检查响应时间是否有值
- 如果显示SSL警告，这是正常的

### 问题2：站点检查超时

**现象**：
- 点击"立即检查"后，长时间无响应

**可能原因**：
- 站点确实无法访问
- 网络连接问题
- 站点响应时间过长

**处理**：
- 系统默认超时时间为10秒
- 超时后站点状态会更新为"离线"
- 可以检查网络连接或站点是否正常运行

### 问题3：站点状态不更新

**现象**：
- 点击"立即检查"后，站点状态没有变化

**检查步骤**：
1. 检查浏览器控制台是否有错误
2. 检查后端日志是否有错误信息
3. 确认站点URL是否正确
4. 尝试手动访问站点URL验证是否可达

## 四、API测试

如果需要直接测试API，可以使用以下curl命令：

### 1. 获取站点列表
```bash
curl -X GET "http://localhost:8000/api/sites" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 立即检查站点
```bash
curl -X POST "http://localhost:8000/api/sites/1/check" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 3. 批量删除站点
```bash
curl -X POST "http://localhost:8000/api/sites/batch/delete" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '[1, 2, 3]'
```

### 4. 批量更新监控状态
```bash
curl -X POST "http://localhost:8000/api/sites/batch/update-monitoring" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"site_ids": [1, 2, 3], "is_monitored": true}'
```

## 五、测试检查清单

- [ ] 能够成功添加HTTP站点
- [ ] 能够成功添加HTTPS站点（域名）
- [ ] 能够成功添加HTTPS站点（IP地址）
- [ ] 立即检查功能正常工作
- [ ] HTTP站点检查返回正确状态
- [ ] HTTPS站点检查返回正确状态和SSL信息
- [ ] IP地址HTTPS站点检查处理SSL警告
- [ ] 站点详情页显示正确的监控数据
- [ ] 批量选择功能正常
- [ ] 批量删除功能正常
- [ ] 批量启用/禁用监控功能正常
- [ ] 搜索功能正常
- [ ] 状态筛选功能正常
- [ ] 分组筛选功能正常

## 六、性能测试

1. **大量站点测试**
   - 添加100+个站点
   - 测试列表加载性能
   - 测试批量操作性能

2. **并发检查测试**
   - 同时触发多个站点的立即检查
   - 观察系统响应

## 七、注意事项

1. **SSL证书验证**
   - 对于生产环境，建议使用有效的SSL证书
   - 对于内网IP访问，可以考虑使用自签名证书或配置证书信任

2. **监控频率**
   - 立即检查是手动触发的
   - 自动监控功能需要配置定时任务（待实现）

3. **数据保留**
   - 历史监控数据存储在TimescaleDB中
   - 需要配置数据保留策略（待实现）

## 八、后续功能开发计划

- [ ] 分组管理界面（前端CRUD）
- [ ] 站点告警规则配置
- [ ] 站点检查配置（间隔、超时等）
- [ ] 站点健康度评分
- [ ] 站点维护模式
- [ ] 自动监控定时任务
- [ ] 监控数据导出
