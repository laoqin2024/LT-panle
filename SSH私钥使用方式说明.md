# SSH私钥使用方式说明

## 问题：私钥路径如何连接到远程服务器？

### 关键理解

**私钥路径是相对于后端服务器的路径**，不是用户本地机器的路径！

## 两种使用方式

### 方式1：私钥路径方式（后端服务器上有私钥文件）

**工作原理：**
```
用户浏览器 → 前端 → 后端服务器（有私钥文件） → 远程服务器
                                    ↑
                              使用私钥路径读取文件
```

**适用场景：**
- 私钥文件已经上传到后端服务器
- 后端服务器可以访问私钥文件路径
- 适合集中管理的场景

**优点：**
- 私钥不存储在数据库中
- 可以使用系统已有的私钥文件

**缺点：**
- 需要确保后端服务器可以访问该路径
- 私钥文件需要手动管理
- 路径必须是后端服务器上的绝对路径

**示例：**
```python
# 后端服务器上的路径
ssh_key_path = "/opt/ssh_keys/server1_id_rsa"
# 后端服务器可以直接读取这个文件
```

### 方式2：私钥内容方式（推荐）⭐

**工作原理：**
```
用户浏览器 → 前端（输入私钥内容） → 后端服务器（加密存储） → 远程服务器
                                                      ↑
                                              解密后加载到内存使用
```

**适用场景：**
- 私钥在用户本地机器上
- 需要跨服务器使用
- 需要集中管理多个私钥

**优点：**
- ✅ **最灵活**：不依赖文件系统路径
- ✅ **可移植**：私钥内容存储在数据库中
- ✅ **易管理**：统一在数据库中管理
- ✅ **安全性**：私钥内容加密存储

**缺点：**
- 私钥内容需要加密存储（已实现）
- 需要用户复制私钥内容

**示例：**
```python
# 用户在前端输入私钥内容
private_key_content = """
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA...
-----END RSA PRIVATE KEY-----
"""

# 后端加密存储到数据库
# 使用时解密并加载到内存
```

## 推荐方案：私钥内容方式

### 为什么推荐私钥内容方式？

1. **灵活性**：不依赖后端服务器的文件系统
2. **可移植性**：可以在任何后端服务器上使用
3. **易管理**：统一在数据库中管理所有私钥
4. **安全性**：私钥内容加密存储

### 实现方式

1. **前端**：用户输入私钥内容（文本区域）
2. **后端**：加密存储到数据库
3. **连接时**：解密私钥内容，使用paramiko加载到内存

## 当前实现状态

目前代码中：
- ✅ 数据库字段：`password_encrypted`（可以存储私钥内容）
- ✅ 数据库字段：`ssh_key_path`（可以存储私钥路径）
- ❌ SSH密钥认证功能未完全实现

## 需要实现的功能

1. ✅ 支持私钥内容方式（优先）
2. ✅ 支持私钥路径方式（备选）
3. ✅ 前端可以选择使用哪种方式
4. ✅ 后端根据选择使用相应的认证方式
