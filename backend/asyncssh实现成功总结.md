# asyncssh SSHç»ˆç«¯å®ç°æˆåŠŸæ€»ç»“ ğŸ‰

## âœ… æˆåŠŸå®ç°çš„åŠŸèƒ½

### 1. åŸºæœ¬åŠŸèƒ½
- âœ… SSHè¿æ¥å»ºç«‹
- âœ… äº¤äº’å¼shellåˆ›å»º
- âœ… WebSocketåŒå‘é€šä¿¡
- âœ… å‘½ä»¤æ‰§è¡Œå’Œè¾“å‡ºæ˜¾ç¤º
- âœ… ç»ˆç«¯äº¤äº’æ­£å¸¸

### 2. æŠ€æœ¯å®ç°
- âœ… ä½¿ç”¨asyncsshåº“ï¼ˆåŸç”Ÿå¼‚æ­¥ï¼‰
- âœ… æ”¯æŒå¯†ç è®¤è¯
- âœ… æ”¯æŒSSHå¯†é’¥è®¤è¯
- âœ… WebSocketæ¶ˆæ¯å¤„ç†
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 3. æµ‹è¯•éªŒè¯
- âœ… åŸºæœ¬è¿æ¥æµ‹è¯•é€šè¿‡
- âœ… WebSocketé€šä¿¡æµ‹è¯•é€šè¿‡
- âœ… å‘½ä»¤æ‰§è¡Œæµ‹è¯•é€šè¿‡
- âœ… å‰ç«¯é›†æˆæµ‹è¯•é€šè¿‡

## ğŸ“Š å®ç°å¯¹æ¯”

| ç‰¹æ€§ | paramiko (æ—§) | asyncssh (æ–°) |
|------|---------------|---------------|
| å¼‚æ­¥æ”¯æŒ | éœ€è¦çº¿ç¨‹æ±  | åŸç”Ÿå¼‚æ­¥ âœ… |
| ä»£ç å¤æ‚åº¦ | è¾ƒé«˜ | è¾ƒä½ âœ… |
| æ€§èƒ½ | ä¸€èˆ¬ | æ›´å¥½ âœ… |
| é”™è¯¯å¤„ç† | éœ€è¦æ‰‹åŠ¨å¤„ç† | æ›´æ¸…æ™° âœ… |
| ç»´æŠ¤æ€§ | ä¸€èˆ¬ | æ›´å¥½ âœ… |

## ğŸ¯ å…³é”®æ”¹è¿›

### 1. APIä½¿ç”¨
```python
# æ­£ç¡®ä½¿ç”¨create_processåˆ›å»ºäº¤äº’å¼shell
process = await conn.create_process(
    None,  # Noneè¡¨ç¤ºåˆ›å»ºäº¤äº’å¼shell
    term_type='xterm-256color',
    term_size=(80, 24)
)
stdin, stdout, stderr = process.stdin, process.stdout, process.stderr
```

### 2. æ•°æ®ç±»å‹å¤„ç†
```python
# stdin.writeéœ€è¦å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å­—èŠ‚
stdin.write('command\n')  # âœ… æ­£ç¡®

# stdout.read()è¿”å›å­—ç¬¦ä¸²ï¼Œä¸éœ€è¦decode
data = await stdout.read(1024)  # âœ… è¿”å›å­—ç¬¦ä¸²
```

### 3. ç™»å½•æ¥å£ä¿®å¤
```python
# æ”¯æŒè¡¨å•æ•°æ®æ ¼å¼
@router.post("/login")
async def login(
    username: str = Form(...),
    password: str = Form(...),
    ...
):
```

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒå®ç°æ–‡ä»¶
- `backend/app/api/server_ssh_asyncssh.py` - asyncssh SSHç»ˆç«¯å®ç°
- `backend/app/main.py` - è·¯ç”±æ³¨å†Œ

### æµ‹è¯•å’Œæ–‡æ¡£
- `backend/test_asyncssh.py` - åŸºæœ¬åŠŸèƒ½æµ‹è¯•è„šæœ¬
- `backend/æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•ä»£ç .js` - WebSocketæµ‹è¯•ä»£ç 
- `backend/asyncsshæµ‹è¯•è°ƒè¯•æŒ‡å—.md` - æµ‹è¯•è°ƒè¯•æŒ‡å—
- `backend/asyncsshä¿®å¤æ€»ç»“.md` - ä¿®å¤æ€»ç»“
- `backend/WebSocketæµ‹è¯•ä¿®å¤è¯´æ˜.md` - WebSocketæµ‹è¯•è¯´æ˜
- `backend/SSHç»ˆç«¯é‡æ„æ–¹æ¡ˆ.md` - é‡æ„æ–¹æ¡ˆæ–‡æ¡£

## ğŸš€ ä½¿ç”¨æ–¹å¼

### WebSocketç«¯ç‚¹
```
ws://localhost:8000/api/servers/{server_id}/ssh/terminal/asyncssh?credential_id={id}&token={token}
```

### æ¶ˆæ¯æ ¼å¼

**å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨**:
```json
{"type": "input", "data": "å‘½ä»¤\n"}
{"type": "resize", "rows": 24, "cols": 80}
```

**æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯**:
```json
{"type": "connected", "message": "SSHç»ˆç«¯å·²è¿æ¥"}
{"type": "output", "data": "å‘½ä»¤è¾“å‡º"}
{"type": "error", "message": "é”™è¯¯ä¿¡æ¯"}
```

## ğŸ”§ åç»­ä¼˜åŒ–å»ºè®®

### 1. å‰ç«¯é›†æˆ
- [ ] æ›´æ–°å‰ç«¯ `SshTerminal.tsx` ç»„ä»¶ä½¿ç”¨æ–°ç«¯ç‚¹
- [ ] æ·»åŠ è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º

### 2. åŠŸèƒ½å¢å¼º
- [ ] å®ç°ç»ˆç«¯å¤§å°è°ƒæ•´
- [ ] æ·»åŠ è¿æ¥æ± ç®¡ç†ï¼ˆè¶…æ—¶æ¸…ç†ï¼‰
- [ ] æ”¯æŒè·³æ¿æœºè¿æ¥
- [ ] æ·»åŠ è¿æ¥å†å²è®°å½•

### 3. æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°è¾“å‡ºç¼“å†²
- [ ] ä¼˜åŒ–å¤§è¾“å‡ºå¤„ç†
- [ ] æ·»åŠ è¿æ¥å¤ç”¨æœºåˆ¶

### 4. å®‰å…¨æ€§
- [ ] æ·»åŠ ä¸»æœºå¯†é’¥éªŒè¯
- [ ] å®ç°è¿æ¥è¶…æ—¶
- [ ] æ·»åŠ è®¿é—®æ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [asyncsshå®˜æ–¹æ–‡æ¡£](https://asyncssh.readthedocs.io/)
- [FastAPI WebSocketæ–‡æ¡£](https://fastapi.tiangolo.com/advanced/websockets/)
- [xterm.jsæ–‡æ¡£](https://xtermjs.org/)

## ğŸŠ æ€»ç»“

é€šè¿‡ä½¿ç”¨ `asyncssh` åº“ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ï¼š
1. âœ… åŸç”Ÿå¼‚æ­¥SSHç»ˆç«¯
2. âœ… æ›´å¥½çš„æ€§èƒ½å’Œå¹¶å‘æ”¯æŒ
3. âœ… æ›´ç®€æ´çš„ä»£ç 
4. âœ… æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†

**å®ç°å®Œæˆï¼å¯ä»¥å¼€å§‹ä½¿ç”¨æ–°çš„SSHç»ˆç«¯åŠŸèƒ½äº†ï¼** ğŸ‰
