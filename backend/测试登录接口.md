# æµ‹è¯•ç™»å½•æ¥å£

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd "/Volumes/MyDisk/App programs/laoqin-panle/backend"
source venv-panle/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. è®¿é—®APIæ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **Swagger UI**: http://localhost:8000/api/docs
- **ReDoc**: http://localhost:8000/api/redoc

### 3. ä½¿ç”¨Swagger UIæµ‹è¯•

1. åœ¨Swagger UIä¸­æ‰¾åˆ° `/api/auth/login` æ¥å£
2. ç‚¹å‡» "Try it out"
3. è¾“å…¥æµ‹è¯•æ•°æ®ï¼š
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
4. ç‚¹å‡» "Execute"
5. æŸ¥çœ‹å“åº”ç»“æœ

---

## ğŸ“ ä½¿ç”¨curlæµ‹è¯•

### æµ‹è¯•ç™»å½•

```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "full_name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "role_id": 1,
    "role_name": "admin",
    "is_active": true,
    "is_superuser": true,
    "last_login": "2026-01-10T07:30:00Z",
    "created_at": "2026-01-10T07:17:59Z"
  }
}
```

### æµ‹è¯•è·å–å½“å‰ç”¨æˆ·ï¼ˆéœ€è¦tokenï¼‰

```bash
# å…ˆç™»å½•è·å–token
TOKEN=$(curl -s -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}' \
  | jq -r '.token')

# ä½¿ç”¨tokenè·å–ç”¨æˆ·ä¿¡æ¯
curl -X GET "http://localhost:8000/api/auth/me" \
  -H "Authorization: Bearer $TOKEN"
```

### æµ‹è¯•ç™»å‡º

```bash
curl -X POST "http://localhost:8000/api/auth/logout" \
  -H "Authorization: Bearer $TOKEN"
```

---

## ğŸ ä½¿ç”¨Pythonæµ‹è¯•

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_login.py`:

```python
import requests
import json

BASE_URL = "http://localhost:8000/api"

# æµ‹è¯•ç™»å½•
print("1. æµ‹è¯•ç™»å½•...")
response = requests.post(
    f"{BASE_URL}/auth/login",
    json={
        "username": "admin",
        "password": "admin123"
    }
)

if response.status_code == 200:
    data = response.json()
    token = data["token"]
    user = data["user"]
    print(f"âœ… ç™»å½•æˆåŠŸï¼")
    print(f"   ç”¨æˆ·: {user['username']}")
    print(f"   è§’è‰²: {user['role_name']}")
    print(f"   Token: {token[:50]}...")
    
    # æµ‹è¯•è·å–å½“å‰ç”¨æˆ·
    print("\n2. æµ‹è¯•è·å–å½“å‰ç”¨æˆ·...")
    headers = {"Authorization": f"Bearer {token}"}
    me_response = requests.get(f"{BASE_URL}/auth/me", headers=headers)
    
    if me_response.status_code == 200:
        print("âœ… è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼")
        print(json.dumps(me_response.json(), indent=2, ensure_ascii=False))
    
    # æµ‹è¯•ç™»å‡º
    print("\n3. æµ‹è¯•ç™»å‡º...")
    logout_response = requests.post(f"{BASE_URL}/auth/logout", headers=headers)
    if logout_response.status_code == 200:
        print("âœ… ç™»å‡ºæˆåŠŸï¼")
    
else:
    print(f"âŒ ç™»å½•å¤±è´¥: {response.status_code}")
    print(response.text)
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
cd backend
source venv-panle/bin/activate
python test_login.py
```

---

## ğŸŒ å‰ç«¯æµ‹è¯•

### 1. å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm run dev
```

### 2. è®¿é—®ç™»å½•é¡µé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173/login

### 3. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

### 4. æ£€æŸ¥

- âœ… ç™»å½•æˆåŠŸåè·³è½¬åˆ° `/dashboard`
- âœ… ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
- âœ… Tokenå·²ä¿å­˜åˆ°localStorage

---

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯1: 401 Unauthorized

**åŸå› **: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

**è§£å†³**:
- æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨ï¼ˆ`is_active=False`ï¼‰

### é”™è¯¯2: 500 Internal Server Error

**åŸå› **: æ•°æ®åº“è¿æ¥é—®é¢˜æˆ–ä»£ç é”™è¯¯

**è§£å†³**:
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œï¼š`docker-compose ps`
- æŸ¥çœ‹åç«¯æ—¥å¿—
- æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®

### é”™è¯¯3: ModuleNotFoundError

**åŸå› **: è™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»æˆ–ä¾èµ–æœªå®‰è£…

**è§£å†³**:
```bash
cd backend
source venv-panle/bin/activate
pip install -r requirements.txt
```

### é”™è¯¯4: ç«¯å£è¢«å ç”¨

**åŸå› **: 8000ç«¯å£å·²è¢«å…¶ä»–æœåŠ¡å ç”¨

**è§£å†³**:
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
lsof -i :8000

# åœæ­¢è¿›ç¨‹æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] APIæ–‡æ¡£å¯ä»¥è®¿é—®
- [ ] ç™»å½•æ¥å£è¿”å›200çŠ¶æ€ç 
- [ ] è¿”å›çš„tokenæ ¼å¼æ­£ç¡®
- [ ] ç”¨æˆ·ä¿¡æ¯å®Œæ•´
- [ ] è·å–å½“å‰ç”¨æˆ·æ¥å£æ­£å¸¸å·¥ä½œ
- [ ] ç™»å‡ºæ¥å£æ­£å¸¸å·¥ä½œ
- [ ] å‰ç«¯å¯ä»¥æˆåŠŸç™»å½•
- [ ] Tokenæ­£ç¡®ä¿å­˜åˆ°localStorage
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨éœ€è¦è®¤è¯çš„API

---

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸå“åº”

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwidXNlcm5hbWUiOiJhZG1pbiIsImVtYWlsIjoiYWRtaW5AZXhhbXBsZS5jb20iLCJleHAiOjE3MDQ5MDgwMDAsInR5cGUiOiJhY2Nlc3MifQ...",
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "full_name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "role_id": 1,
    "role_name": "admin",
    "is_active": true,
    "is_superuser": true,
    "last_login": "2026-01-10T07:30:00Z",
    "created_at": "2026-01-10T07:17:59Z"
  }
}
```

### é”™è¯¯å“åº”

```json
{
  "detail": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
}
```

---

## ğŸ‰ å®Œæˆï¼

ç™»å½•æ¥å£å·²å®Œå…¨å®ç°ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•äº†ï¼

