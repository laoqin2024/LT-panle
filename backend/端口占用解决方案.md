# 端口占用问题解决方案

## 当前问题

端口 8000 已被其他进程占用：
- **进程ID**: 3652, 5417
- **项目**: IT_Management
- **命令**: `uvicorn app.main:app --reload --host 0.0.0.0 --port 8000`

---

## 解决方案

### 方案1: 停止占用端口的进程（推荐）

#### 方法A: 使用启动脚本（自动处理）

```bash
cd backend
bash scripts/start_server.sh
```

脚本会自动检测端口占用，并询问是否停止占用进程。

#### 方法B: 手动停止

```bash
# 停止进程
kill -9 3652 5417

# 或停止所有 uvicorn 进程
pkill -f "uvicorn.*8000"

# 然后启动服务
cd backend
source venv-panle/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 方案2: 使用其他端口（如果不想停止其他服务）

```bash
cd backend
source venv-panle/bin/activate

# 使用8001端口
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

**注意**: 如果使用其他端口，需要更新：
- 前端 `.env` 中的 `VITE_API_URL`
- CORS 配置（如果需要）

---

## 快速启动

### 使用启动脚本（推荐）

```bash
cd "/Volumes/MyDisk/App programs/laoqin-panle/backend"
bash scripts/start_server.sh
```

脚本功能：
- ✅ 自动检查端口占用
- ✅ 询问是否停止占用进程
- ✅ 自动启动服务
- ✅ 显示API文档地址

### 手动启动

```bash
# 1. 进入目录
cd "/Volumes/MyDisk/App programs/laoqin-panle/backend"

# 2. 激活虚拟环境
source venv-panle/bin/activate

# 3. 停止占用进程（如果需要）
kill -9 3652 5417

# 4. 启动服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

## 验证服务运行

### 检查服务状态

```bash
# 检查端口
lsof -i :8000

# 检查进程
ps aux | grep uvicorn
```

### 测试API

```bash
# 健康检查
curl http://localhost:8000/api/health

# 访问API文档
open http://localhost:8000/api/docs
```

---

## 如果使用其他端口

### 更新前端配置

编辑 `frontend/.env`:
```env
VITE_API_URL=http://localhost:8001/api
```

### 更新CORS配置

编辑 `backend/app/main.py`:
```python
allow_origins=["http://localhost:5173", "http://localhost:3000", "http://localhost:8001"],
```

---

## 后台运行（可选）

### 使用 nohup

```bash
cd backend
source venv-panle/bin/activate
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 > app.log 2>&1 &
```

### 查看日志

```bash
tail -f app.log
```

### 停止后台服务

```bash
pkill -f "uvicorn.*app.main:app"
```

---

## 总结

**推荐操作**:
1. 运行启动脚本：`bash scripts/start_server.sh`
2. 选择停止占用进程（如果确认是其他项目）
3. 或使用其他端口：`bash scripts/start_server.sh 8001`

